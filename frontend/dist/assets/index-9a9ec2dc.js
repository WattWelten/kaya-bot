var me=Object.defineProperty;var ge=(n,t,s)=>t in n?me(n,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[t]=s;var x=(n,t,s)=>(ge(n,typeof t!="symbol"?t+"":t,s),s);import{r as l,a as fe,R as pe}from"./react-vendor-b1791c80.js";import{X as xe,C as Q,A as ye,I as be,V as we,H as ve,M as Z,P as je,S as Ne,E as G,R as ke,L as Le,T as Se}from"./ui-vendor-fa484402.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();var q={exports:{}},_={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ae=l,Ee=Symbol.for("react.element"),Ce=Symbol.for("react.fragment"),Re=Object.prototype.hasOwnProperty,De=Ae.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Me={key:!0,ref:!0,__self:!0,__source:!0};function X(n,t,s){var r,o={},a=null,d=null;s!==void 0&&(a=""+s),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(d=t.ref);for(r in t)Re.call(t,r)&&!Me.hasOwnProperty(r)&&(o[r]=t[r]);if(n&&n.defaultProps)for(r in t=n.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:Ee,type:n,key:a,ref:d,props:o,_owner:De.current}}_.Fragment=Ce;_.jsx=X;_.jsxs=X;q.exports=_;var e=q.exports,V={},J=fe;V.createRoot=J.createRoot,V.hydrateRoot=J.hydrateRoot;const Ue=({isOpen:n,onClose:t})=>n?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md w-full mx-4 shadow-strong animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-lc-primary-700",children:"Über KAYA"}),e.jsx("button",{onClick:t,className:"btn-ghost","aria-label":"Dialog schließen",children:e.jsx(xe,{className:"size-5"})})]}),e.jsxs("div",{className:"space-y-4 text-lc-neutral-700",children:[e.jsx("p",{className:"leading-relaxed",children:"KAYA ist Ihre digitale Assistentin für alle Anliegen rund um den Landkreis Oldenburg."}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lc-primary-600 mb-2",children:"Ich kann Ihnen helfen bei:"}),e.jsxs("ul",{className:"space-y-1.5 text-sm",children:[e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lc-primary-500",children:"✓"})," Bürgerservices und Anträge"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lc-primary-500",children:"✓"})," Terminbuchung"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lc-primary-500",children:"✓"})," KFZ-Zulassung"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lc-primary-500",children:"✓"})," Soziale Leistungen"]}),e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lc-primary-500",children:"✓"})," Kreistagsinformationen"]})]})]}),e.jsx("div",{className:"pt-4 border-t border-lc-primary-100",children:e.jsxs("p",{className:"text-xs text-lc-neutral-600 italic",children:[e.jsx("strong",{children:"Hinweis:"})," KAYA nutzt öffentliche Informationen des Landkreises Oldenburg. Keine Rechtsberatung. Bei Notfällen wählen Sie bitte 112 oder 110."]})})]}),e.jsx("button",{onClick:t,className:"btn-solid w-full mt-6",children:"Verstanden"})]})}):null,Te=({accessibility:n,onAccessibilityChange:t,onLanguageChange:s})=>{const[r,o]=l.useState(!1),a=()=>{t({...n,highContrast:!n.highContrast})},d=h=>{t({...n,fontSize:h})},g=()=>{t({...n,simpleLanguage:!n.simpleLanguage})},b=h=>{s(h.target.value)};return e.jsxs("header",{className:"h-16 w-full border-b border-lc-primary-100 bg-white/80 backdrop-blur-xl shadow-sm sticky top-0 z-40",children:[e.jsxs("div",{className:"max-w-7xl mx-auto h-full px-4 sm:px-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-lc-primary-500 to-lc-primary-700 flex items-center justify-center shadow-md",children:e.jsx("span",{className:"text-white font-bold text-lg",children:"K"})}),e.jsx("div",{className:"leading-tight",children:e.jsxs("h1",{className:"text-xl font-bold text-lc-primary-700",children:["KAYA ",e.jsx("span",{className:"text-sm font-normal text-lc-neutral-600",children:"· Landkreis Oldenburg"})]})})]}),e.jsxs("nav",{className:"flex items-center gap-2",role:"toolbar","aria-label":"Einstellungen",children:[e.jsx("button",{className:"btn-ghost","aria-pressed":n.highContrast,"aria-label":"Kontrast umschalten",onClick:a,children:e.jsx(Q,{className:"size-5"})}),e.jsxs("div",{className:"flex items-center gap-1",role:"group","aria-label":"Schriftgröße",children:[e.jsx("button",{className:`btn-ghost text-xs ${n.fontSize===100?"bg-lc-neutral-100":""}`,"aria-label":"Schrift 100%",onClick:()=>d(100),children:"A"}),e.jsx("button",{className:`btn-ghost text-sm ${n.fontSize===115?"bg-lc-neutral-100":""}`,"aria-label":"Schrift 115%",onClick:()=>d(115),children:"A+"}),e.jsx("button",{className:`btn-ghost text-base ${n.fontSize===130?"bg-lc-neutral-100":""}`,"aria-label":"Schrift 130%",onClick:()=>d(130),children:"A++"})]}),e.jsx("button",{className:"btn-ghost","aria-pressed":n.simpleLanguage,"aria-label":"Einfache Sprache umschalten",onClick:g,children:e.jsx(ye,{className:"size-5"})}),e.jsxs("select",{className:"btn-ghost text-sm","aria-label":"Sprache wechseln",onChange:b,defaultValue:"de",children:[e.jsx("option",{value:"de",children:"Deutsch"}),e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"tr",children:"Türkçe"}),e.jsx("option",{value:"ar",children:"العربية"}),e.jsx("option",{value:"pl",children:"Polski"}),e.jsx("option",{value:"ru",children:"Русский"})]}),e.jsx("button",{className:"btn-ghost","aria-label":"Hilfe und Hinweise",onClick:()=>o(!0),children:e.jsx(be,{className:"size-5"})})]})]}),e.jsx(Ue,{isOpen:r,onClose:()=>o(!1)})]})};class Ie{constructor(){x(this,"unity",null);x(this,"canvas",null);x(this,"isLoaded",!1);x(this,"isLoading",!1);x(this,"loadListeners",[]);x(this,"errorListeners",[])}async initialize(t="unity-canvas"){if(!(this.isLoading||this.isLoaded)){if(this.isLoading=!0,this.canvas=document.getElementById(t),!this.canvas)throw new Error(`Canvas mit ID '${t}' nicht gefunden`);try{window.createUnityInstance||await this.loadUnityLoader();const s={dataUrl:"/unity/kaya/Build/Build.data",frameworkUrl:"/unity/kaya/Build/Build.framework.js",codeUrl:"/unity/kaya/Build/Build.wasm",streamingAssetsUrl:"/unity/kaya/StreamingAssets",companyName:"Landkreis Oldenburg",productName:"KAYA Avatar",productVersion:"2.0.0"};console.log("🎮 Unity-Instanz wird erstellt..."),this.unity=await window.createUnityInstance(this.canvas,s),this.isLoaded=!0,this.isLoading=!1,this.notifyLoadListeners(!0),console.log("✅ Unity-Instanz erfolgreich geladen"),this.sendUnityMessage({type:"emotion",data:{emotion:"neutral",intensity:.5}})}catch(s){throw this.isLoading=!1,this.notifyErrorListeners({code:"UNITY_LOAD_ERROR",message:"Unity-Instanz konnte nicht geladen werden",details:s instanceof Error?s.message:"Unbekannter Fehler",timestamp:new Date}),s}}}async loadUnityLoader(){return new Promise((t,s)=>{const r=document.createElement("script");r.src="/unity/kaya/Build/Build.loader.js",r.onload=()=>{console.log("📦 Unity Loader geladen"),t()},r.onerror=()=>{s(new Error("Unity Loader konnte nicht geladen werden"))},document.head.appendChild(r)})}sendUnityMessage(t){if(!this.unity){console.warn("⚠️ Unity-Instanz nicht verfügbar");return}try{const s=JSON.stringify(t.data);switch(t.type){case"emotion":this.unity.SendMessage("KayaController","SetEmotion",s);break;case"speaking":this.unity.SendMessage("KayaController","SetSpeaking",s);break;case"gesture":this.unity.SendMessage("KayaController","SetGesture",s);break;case"animation":this.unity.SendMessage("KayaController","PlayAnimation",s);break;default:console.warn("⚠️ Unbekannter Unity-Nachrichtentyp:",t.type)}console.log("📤 Unity-Nachricht gesendet:",t)}catch(s){console.error("❌ Unity-Nachricht Fehler:",s),this.notifyErrorListeners({code:"UNITY_MESSAGE_ERROR",message:"Nachricht an Unity fehlgeschlagen",details:s instanceof Error?s.message:"Unbekannter Fehler",timestamp:new Date})}}setEmotion(t,s=.5){this.sendUnityMessage({type:"emotion",data:{emotion:t,intensity:s}})}setSpeaking(t){this.sendUnityMessage({type:"speaking",data:{isSpeaking:t}})}playGesture(t){this.sendUnityMessage({type:"gesture",data:{gesture:t}})}playAnimation(t){this.sendUnityMessage({type:"animation",data:{animation:t}})}async quit(){if(this.unity)try{await this.unity.Quit(),this.unity=null,this.isLoaded=!1,this.notifyLoadListeners(!1),console.log("🛑 Unity-Instanz beendet")}catch(t){console.error("❌ Unity-Quit Fehler:",t)}}addLoadListener(t){this.loadListeners.push(t)}addErrorListener(t){this.errorListeners.push(t)}removeLoadListener(t){const s=this.loadListeners.indexOf(t);s>-1&&this.loadListeners.splice(s,1)}removeErrorListener(t){const s=this.errorListeners.indexOf(t);s>-1&&this.errorListeners.splice(s,1)}isUnityLoaded(){return this.isLoaded&&this.unity!==null}isUnityLoading(){return this.isLoading}notifyLoadListeners(t){this.loadListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Load-Listener Fehler:",r)}})}notifyErrorListeners(t){this.errorListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Error-Listener Fehler:",r)}})}}let $=null;const ze=()=>($||($=new Ie),$),Fe=(n="unity-canvas")=>{const[t,s]=l.useState(null),[r,o]=l.useState(!1),[a,d]=l.useState(!1),[g,b]=l.useState(null),h=l.useRef(null);l.useEffect(()=>{const u=ze();h.current=u;const w=D=>{o(D),d(!1),D&&(s(u),b(null))},O=D=>{b(D),d(!1),o(!1)};return u.addLoadListener(w),u.addErrorListener(O),()=>{u.removeLoadListener(w),u.removeErrorListener(O)}},[]);const j=l.useCallback(async()=>{if(h.current&&!r&&!a){d(!0),b(null);try{await h.current.initialize(n)}catch(u){console.error("❌ Unity-Initialisierung fehlgeschlagen:",u),b({code:"INITIALIZATION_FAILED",message:"Unity-Initialisierung fehlgeschlagen",details:u instanceof Error?u.message:"Unbekannter Fehler",timestamp:new Date}),d(!1)}}},[n,r,a]),N=l.useCallback(u=>{h.current?h.current.sendUnityMessage(u):console.warn("⚠️ Unity-Service nicht verfügbar")},[]),p=l.useCallback((u,w=.5)=>{h.current&&h.current.setEmotion(u,w)},[]),c=l.useCallback(u=>{h.current&&h.current.setSpeaking(u)},[]),m=l.useCallback(u=>{h.current&&h.current.playGesture(u)},[]),f=l.useCallback(u=>{h.current&&h.current.playAnimation(u)},[]);return{unity:t,isLoaded:r,isLoading:a,sendUnityMessage:N,setEmotion:p,setSpeaking:c,playGesture:m,playAnimation:f,error:g,initialize:j}},Oe=({isSpeaking:n,captionText:t,setIsSpeaking:s,onEmotionChange:r})=>{const{unity:o,isLoaded:a,isLoading:d,setEmotion:g,setSpeaking:b,playGesture:h,playAnimation:j,error:N,initialize:p}=Fe("unity-canvas"),[c,m]=l.useState(!1);l.useEffect(()=>{console.log("Unity-Avatar bereit für Initialisierung"),!c&&!d&&!a&&p().then(()=>{m(!0),console.log("✅ Unity-Avatar erfolgreich initialisiert")}).catch(w=>{console.error("❌ Unity-Initialisierung fehlgeschlagen:",w),m(!0)})},[p,c,d,a]),l.useEffect(()=>{a&&(b(n),n?(g("speaking",.8),j("speaking")):(g("neutral",.5),j("idle")))},[n,a,b,g,j]),l.useEffect(()=>{r&&a&&(t.includes("Hilfe")||t.includes("Problem")?(g("concerned",.7),r("concerned",.7)):(t.includes("Danke")||t.includes("Perfekt"))&&(g("happy",.8),r("happy",.8)))},[t,r,a,g]);const f=()=>{s(!n)},u=()=>{console.log("Verlauf umschalten")};return e.jsxs("section",{"aria-label":"Avatar Bereich",className:"relative bg-gradient-to-b from-lc-neutral-100 to-lc-neutral-100 md:h-[calc(100svh-4rem)] h-[60svh] overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsxs("div",{className:"w-full h-full flex items-center justify-center overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsxs("svg",{width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("defs",{children:e.jsx("pattern",{id:"grid",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"#26A69A",strokeWidth:"0.5"})})}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"})]})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-8 animate-fade-in",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-48 h-48 rounded-full bg-gradient-to-br from-lc-primary-400 to-lc-primary-600 flex items-center justify-center shadow-strong animate-pulse-soft",children:e.jsxs("svg",{viewBox:"0 0 200 200",className:"w-32 h-32 text-white",children:[e.jsxs("g",{className:"animate-spin",style:{animationDuration:"20s"},children:[e.jsx("ellipse",{cx:"100",cy:"40",rx:"15",ry:"35",fill:"currentColor",opacity:"0.9"}),e.jsx("ellipse",{cx:"160",cy:"100",rx:"35",ry:"15",fill:"currentColor",opacity:"0.9"}),e.jsx("ellipse",{cx:"100",cy:"160",rx:"15",ry:"35",fill:"currentColor",opacity:"0.9"}),e.jsx("ellipse",{cx:"40",cy:"100",rx:"35",ry:"15",fill:"currentColor",opacity:"0.9"})]}),e.jsx("circle",{cx:"100",cy:"100",r:"18",fill:"currentColor"})]})}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-lc-primary-400 blur-3xl opacity-30 animate-pulse-soft",style:{animationDelay:"1s"}})]}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("h2",{className:"text-4xl font-bold text-lc-primary-700 tracking-tight",children:"KAYA"}),e.jsx("p",{className:"text-lg text-lc-neutral-600 font-medium",children:"Deine digitale Assistentin"}),e.jsx("p",{className:"text-sm text-lc-neutral-500 max-w-xs mx-auto leading-relaxed",children:"Landkreis Oldenburg · Immer für dich da"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-full border border-lc-primary-200 shadow-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm text-lc-neutral-700 font-medium",children:"Bereit für deine Fragen"})]})]}),e.jsx("div",{className:"absolute bottom-8 left-8 opacity-20 animate-float",style:{animationDelay:"0.5s"},children:e.jsxs("svg",{width:"60",height:"60",viewBox:"0 0 60 60",className:"text-lc-primary-500",children:[e.jsx("circle",{cx:"30",cy:"45",r:"3",fill:"currentColor"}),e.jsx("rect",{x:"28",y:"30",width:"4",height:"15",fill:"currentColor"}),e.jsx("path",{d:"M30 10 L20 25 L40 25 Z",fill:"currentColor",opacity:"0.8"}),e.jsx("path",{d:"M30 18 L22 30 L38 30 Z",fill:"currentColor",opacity:"0.6"})]})}),e.jsx("div",{className:"absolute top-16 right-12 opacity-20 animate-float",style:{animationDelay:"1.2s"},children:e.jsxs("svg",{width:"50",height:"50",viewBox:"0 0 50 50",className:"text-lc-primary-400",children:[e.jsx("path",{d:"M0 25 Q10 15, 20 25 T40 25 T60 25",stroke:"currentColor",strokeWidth:"3",fill:"none"}),e.jsx("path",{d:"M0 32 Q10 22, 20 32 T40 32 T60 32",stroke:"currentColor",strokeWidth:"2",fill:"none",opacity:"0.6"})]})})]}),d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-soft",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-lc-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-lc-neutral-600",children:"KAYA wird geladen..."})]})}),N&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-lc-neutral-100",children:e.jsxs("div",{className:"text-center p-6",children:[e.jsx("div",{className:"text-lc-neutral-400 mb-4",children:e.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsx("h3",{className:"text-lg font-semibold text-lc-neutral-800 mb-2",children:"Avatar nicht verfügbar"}),e.jsx("p",{className:"text-sm text-lc-neutral-600 mb-4",children:N.message}),e.jsx("button",{onClick:()=>p(),className:"btn-solid",children:"Erneut versuchen"})]})}),e.jsx("canvas",{id:"unity-canvas",className:"w-full h-full block",style:{display:a?"block":"none"}})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 md:left-6 md:right-6 flex items-center justify-between",children:[e.jsx("div",{className:"px-3 py-2 rounded-2xl bg-white/75 backdrop-blur border border-white/60 shadow-soft max-w-[80%]",children:e.jsx("p",{className:"text-sm text-lc-neutral-800",children:"Moin! Ich bin KAYA. Wobei kann ich Ihnen helfen?"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-solid","aria-label":n?"Audio stoppen":"Audio vorlesen",onClick:f,children:e.jsx(we,{className:"size-5"})}),e.jsx("button",{className:"btn-ghost","aria-label":"Verlauf ausblenden",onClick:u,children:e.jsx(ve,{className:"size-5"})})]})]}),n&&e.jsx("div",{"aria-live":"polite",className:"absolute left-4 right-4 bottom-20 md:bottom-24 text-sm text-lc-neutral-800 bg-white/90 backdrop-blur rounded-xl px-3 py-2 shadow-soft",children:t||"Ich lese Ihnen die nächsten Schritte vor …"}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${a?"bg-green-100 text-green-800":d?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:a?"Online":d?"Lädt...":"Offline"})})]})};class Pe{constructor(t){x(this,"ws",null);x(this,"sessionId");x(this,"reconnectAttempts",0);x(this,"maxReconnectAttempts",5);x(this,"reconnectDelay",1e3);x(this,"isConnecting",!1);x(this,"messageListeners",[]);x(this,"connectionListeners",[]);x(this,"errorListeners",[]);this.sessionId=t}async connect(){if(!(this.isConnecting||this.ws&&this.ws.readyState===WebSocket.OPEN)){this.isConnecting=!0;try{const t=this.getWebSocketUrl();this.ws=new WebSocket(t),this.ws.onopen=()=>{console.log("🔗 WebSocket verbunden"),this.isConnecting=!1,this.reconnectAttempts=0,this.notifyConnectionListeners(!0)},this.ws.onmessage=s=>{try{const r=JSON.parse(s.data);this.handleMessage(r)}catch(r){console.error("❌ WebSocket Nachricht-Parsing Fehler:",r),this.notifyErrorListeners({code:"PARSE_ERROR",message:"Fehler beim Verarbeiten der Nachricht",details:r instanceof Error?r.message:"Unbekannter Fehler",timestamp:new Date})}},this.ws.onclose=s=>{console.log("🔌 WebSocket geschlossen:",s.code,s.reason),this.isConnecting=!1,this.notifyConnectionListeners(!1),!s.wasClean&&this.reconnectAttempts<this.maxReconnectAttempts&&this.scheduleReconnect()},this.ws.onerror=s=>{console.error("❌ WebSocket Fehler:",s),this.isConnecting=!1,this.notifyErrorListeners({code:"WEBSOCKET_ERROR",message:"Verbindungsfehler",details:"WebSocket-Verbindung fehlgeschlagen",timestamp:new Date})}}catch(t){throw this.isConnecting=!1,this.notifyErrorListeners({code:"CONNECTION_ERROR",message:"Verbindung fehlgeschlagen",details:t instanceof Error?t.message:"Unbekannter Fehler",timestamp:new Date}),t}}}sendMessage(t){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("⚠️ WebSocket nicht verbunden");return}const s={type:"message",sessionId:this.sessionId,data:{message:t,timestamp:new Date().toISOString(),type:"text"},timestamp:new Date};this.ws.send(JSON.stringify(s))}sendAudioMessage(t,s="audio/wav"){if(!this.ws||this.ws.readyState!==WebSocket.OPEN){console.warn("⚠️ WebSocket nicht verbunden");return}const r={type:"message",sessionId:this.sessionId,data:{message:t,type:"audio",format:s,timestamp:new Date().toISOString()},timestamp:new Date};this.ws.send(JSON.stringify(r))}disconnect(){this.ws&&(this.ws.close(1e3,"Client disconnect"),this.ws=null)}addMessageListener(t){this.messageListeners.push(t)}addConnectionListener(t){this.connectionListeners.push(t)}addErrorListener(t){this.errorListeners.push(t)}removeMessageListener(t){const s=this.messageListeners.indexOf(t);s>-1&&this.messageListeners.splice(s,1)}removeConnectionListener(t){const s=this.connectionListeners.indexOf(t);s>-1&&this.connectionListeners.splice(s,1)}removeErrorListener(t){const s=this.errorListeners.indexOf(t);s>-1&&this.errorListeners.splice(s,1)}isConnected(){return this.ws!==null&&this.ws.readyState===WebSocket.OPEN}getWebSocketUrl(){return`wss://api.kaya.wattweiser.com/ws?sessionId=${this.sessionId}`}handleMessage(t){console.log("📨 WebSocket Nachricht erhalten:",t),this.notifyMessageListeners(t)}scheduleReconnect(){this.reconnectAttempts++;const t=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`🔄 Reconnect in ${t}ms (Versuch ${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect().catch(s=>{console.error("❌ Reconnect fehlgeschlagen:",s)})},t)}notifyMessageListeners(t){this.messageListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Message-Listener Fehler:",r)}})}notifyConnectionListeners(t){this.connectionListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Connection-Listener Fehler:",r)}})}notifyErrorListeners(t){this.errorListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Error-Listener Fehler:",r)}})}}let I=null;const Ke=n=>((!I||n&&I.sessionId!==n)&&(I&&I.disconnect(),I=new Pe(n||_e())),I);function _e(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}const $e=n=>{const[t,s]=l.useState(!1),[r,o]=l.useState(null),[a,d]=l.useState(null),g=l.useRef(null),b=l.useRef(null);l.useEffect(()=>{const p=Ke(n);g.current=p;const c=u=>{o(u),d(null)},m=u=>{s(u),u&&d(null)},f=u=>{d(u),s(!1)};return p.addMessageListener(c),p.addConnectionListener(m),p.addErrorListener(f),p.connect().catch(u=>{console.error("❌ WebSocket Verbindung fehlgeschlagen:",u),d({code:"CONNECTION_FAILED",message:"Verbindung zum Server fehlgeschlagen",details:u instanceof Error?u.message:"Unbekannter Fehler",timestamp:new Date})}),()=>{p.removeMessageListener(c),p.removeConnectionListener(m),p.removeErrorListener(f),b.current&&clearTimeout(b.current)}},[n]);const h=l.useCallback(p=>{g.current?g.current.sendMessage(p):console.warn("⚠️ WebSocket-Service nicht verfügbar")},[]),j=l.useCallback((p,c="audio/wav")=>{g.current?g.current.sendAudioMessage(p,c):console.warn("⚠️ WebSocket-Service nicht verfügbar")},[]),N=l.useCallback(()=>{g.current&&(g.current.disconnect(),g.current.connect().catch(p=>{console.error("❌ Reconnect fehlgeschlagen:",p),d({code:"RECONNECT_FAILED",message:"Wiederverbindung fehlgeschlagen",details:p instanceof Error?p.message:"Unbekannter Fehler",timestamp:new Date})}))},[]);return{isConnected:t,sendMessage:h,sendAudioMessage:j,lastMessage:r,error:a,reconnect:N}};class Be{constructor(){x(this,"mediaRecorder",null);x(this,"audioContext",null);x(this,"audioChunks",[]);x(this,"isRecording",!1);x(this,"isPlaying",!1);x(this,"currentAudio",null);x(this,"recordingListeners",[]);x(this,"playingListeners",[]);x(this,"errorListeners",[]);x(this,"recordedAudioBlob",null)}async startRecording(){if(!this.isRecording)try{const t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});this.audioContext=new AudioContext,this.audioChunks=[],this.mediaRecorder=new MediaRecorder(t,{mimeType:"audio/webm;codecs=opus"}),this.mediaRecorder.ondataavailable=s=>{s.data.size>0&&this.audioChunks.push(s.data)},this.mediaRecorder.onstop=()=>{const s=new Blob(this.audioChunks,{type:"audio/webm"});this.handleRecordingComplete(s),t.getTracks().forEach(r=>r.stop())},this.mediaRecorder.start(100),this.isRecording=!0,this.notifyRecordingListeners(!0),console.log("🎤 Audio-Aufnahme gestartet")}catch(t){throw console.error("❌ Audio-Aufnahme Fehler:",t),this.notifyErrorListeners({code:"RECORDING_ERROR",message:"Audio-Aufnahme fehlgeschlagen",details:t instanceof Error?t.message:"Unbekannter Fehler",timestamp:new Date}),t}}stopRecording(){!this.isRecording||!this.mediaRecorder||(this.mediaRecorder.stop(),this.isRecording=!1,this.notifyRecordingListeners(!1),console.log("🛑 Audio-Aufnahme gestoppt"))}async playAudio(t){this.isPlaying&&this.stopAudio();try{this.currentAudio=new Audio(t),this.currentAudio.onplay=()=>{this.isPlaying=!0,this.notifyPlayingListeners(!0)},this.currentAudio.onended=()=>{this.isPlaying=!1,this.notifyPlayingListeners(!1),this.currentAudio=null},this.currentAudio.onerror=()=>{this.isPlaying=!1,this.notifyPlayingListeners(!1),this.notifyErrorListeners({code:"PLAYBACK_ERROR",message:"Audio-Wiedergabe fehlgeschlagen",details:"Audio-Datei konnte nicht abgespielt werden",timestamp:new Date})},await this.currentAudio.play(),console.log("🔊 Audio-Wiedergabe gestartet")}catch(s){throw console.error("❌ Audio-Wiedergabe Fehler:",s),this.notifyErrorListeners({code:"PLAYBACK_ERROR",message:"Audio-Wiedergabe fehlgeschlagen",details:s instanceof Error?s.message:"Unbekannter Fehler",timestamp:new Date}),s}}stopAudio(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null),this.isPlaying=!1,this.notifyPlayingListeners(!1)}async textToSpeech(t,s="de-DE"){try{return"speechSynthesis"in window?this.webSpeechTTS(t,s):this.serverTTS(t,s)}catch(r){throw console.error("❌ TTS Fehler:",r),this.notifyErrorListeners({code:"TTS_ERROR",message:"Text-zu-Sprache Konvertierung fehlgeschlagen",details:r instanceof Error?r.message:"Unbekannter Fehler",timestamp:new Date}),r}}async webSpeechTTS(t,s){return new Promise((r,o)=>{const a=new SpeechSynthesisUtterance(t);a.lang=s,a.rate=.9,a.pitch=1,a.volume=1,a.onend=()=>{r("web-speech-completed")},a.onerror=d=>{o(new Error(`Web Speech TTS Fehler: ${d.error}`))},speechSynthesis.speak(a)})}async serverTTS(t,s){const r=await fetch("/api/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,language:s,voice:"kaya"})});if(!r.ok)throw new Error(`TTS Server Fehler: ${r.status}`);const o=await r.blob();return URL.createObjectURL(o)}async speechToText(t){try{const s=new FormData;s.append("audio",t,"recording.webm"),s.append("language","de-DE");const o=await fetch("https://api.kaya.wattweiser.com/api/stt",{method:"POST",body:s});if(!o.ok)throw new Error(`STT Server Fehler: ${o.status}`);return(await o.json()).text}catch(s){throw console.error("❌ STT Fehler:",s),this.notifyErrorListeners({code:"STT_ERROR",message:"Sprache-zu-Text Konvertierung fehlgeschlagen",details:s instanceof Error?s.message:"Unbekannter Fehler",timestamp:new Date}),s}}async audioChat(t){try{const s=new FormData;s.append("audio",t,"recording.webm");const r="https://api.kaya.wattweiser.com/api/audio-chat";console.log("🎙️ Sende Audio-Chat Request...");const o=await fetch(r,{method:"POST",body:s});if(!o.ok)throw new Error(`Audio-Chat Server Fehler: ${o.status}`);const a=await o.json();return console.log("✅ Audio-Chat Response erhalten:",a),{transcription:a.transcription,response:a.response,audioUrl:a.audioUrl}}catch(s){throw console.error("❌ Audio-Chat Fehler:",s),this.notifyErrorListeners({code:"AUDIO_CHAT_ERROR",message:"Audio-Chat fehlgeschlagen",details:s instanceof Error?s.message:"Unbekannter Fehler",timestamp:new Date}),s}}async audioToBase64(t){return new Promise((s,r)=>{const o=new FileReader;o.onload=()=>{const a=o.result;s(a.split(",")[1])},o.onerror=()=>{r(new Error("Audio zu Base64 Konvertierung fehlgeschlagen"))},o.readAsDataURL(t)})}handleRecordingComplete(t){console.log("📹 Audio-Aufnahme abgeschlossen:",t.size,"bytes"),this.recordedAudioBlob=t}getRecordedAudio(){return this.recordedAudioBlob}clearRecordedAudio(){this.recordedAudioBlob=null}addRecordingListener(t){this.recordingListeners.push(t)}addPlayingListener(t){this.playingListeners.push(t)}addErrorListener(t){this.errorListeners.push(t)}removeRecordingListener(t){const s=this.recordingListeners.indexOf(t);s>-1&&this.recordingListeners.splice(s,1)}removePlayingListener(t){const s=this.playingListeners.indexOf(t);s>-1&&this.playingListeners.splice(s,1)}removeErrorListener(t){const s=this.errorListeners.indexOf(t);s>-1&&this.errorListeners.splice(s,1)}isCurrentlyRecording(){return this.isRecording}isCurrentlyPlaying(){return this.isPlaying}notifyRecordingListeners(t){this.recordingListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Recording-Listener Fehler:",r)}})}notifyPlayingListeners(t){this.playingListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Playing-Listener Fehler:",r)}})}notifyErrorListeners(t){this.errorListeners.forEach(s=>{try{s(t)}catch(r){console.error("❌ Error-Listener Fehler:",r)}})}}let B=null;const ee=()=>(B||(B=new Be),B),We=()=>{const[n,t]=l.useState(!1),[s,r]=l.useState(!1),[o,a]=l.useState(null),d=l.useRef(null);l.useEffect(()=>{const c=ee();d.current=c;const m=w=>{t(w)},f=w=>{r(w)},u=w=>{a(w)};return c.addRecordingListener(m),c.addPlayingListener(f),c.addErrorListener(u),()=>{c.removeRecordingListener(m),c.removePlayingListener(f),c.removeErrorListener(u)}},[]);const g=l.useCallback(async()=>{if(d.current)try{await d.current.startRecording(),a(null)}catch(c){console.error("❌ Aufnahme-Start fehlgeschlagen:",c),a({code:"RECORDING_START_FAILED",message:"Aufnahme konnte nicht gestartet werden",details:c instanceof Error?c.message:"Unbekannter Fehler",timestamp:new Date})}},[]),b=l.useCallback(()=>{d.current&&d.current.stopRecording()},[]),h=l.useCallback(async c=>{if(d.current)try{await d.current.playAudio(c),a(null)}catch(m){console.error("❌ Audio-Wiedergabe fehlgeschlagen:",m),a({code:"PLAYBACK_FAILED",message:"Audio konnte nicht abgespielt werden",details:m instanceof Error?m.message:"Unbekannter Fehler",timestamp:new Date})}},[]),j=l.useCallback(()=>{d.current&&d.current.stopAudio()},[]),N=l.useCallback(async(c,m="de-DE")=>{if(d.current)try{const f=await d.current.textToSpeech(c,m);return a(null),f}catch(f){throw console.error("❌ TTS fehlgeschlagen:",f),a({code:"TTS_FAILED",message:"Text-zu-Sprache Konvertierung fehlgeschlagen",details:f instanceof Error?f.message:"Unbekannter Fehler",timestamp:new Date}),f}throw new Error("Audio-Service nicht verfügbar")},[]),p=l.useCallback(async c=>{if(d.current)try{const m=await d.current.speechToText(c);return a(null),m}catch(m){throw console.error("❌ STT fehlgeschlagen:",m),a({code:"STT_FAILED",message:"Sprache-zu-Text Konvertierung fehlgeschlagen",details:m instanceof Error?m.message:"Unbekannter Fehler",timestamp:new Date}),m}throw new Error("Audio-Service nicht verfügbar")},[]);return{isRecording:n,isPlaying:s,startRecording:g,stopRecording:b,playAudio:h,stopAudio:j,textToSpeech:N,speechToText:p,error:o}},Ve=({setCaptionText:n,onMessageSend:t})=>{const[s,r]=l.useState([{id:"1",content:"Moin! KAYA hier vom Landkreis Oldenburg. Womit kann ich dir direkt helfen?",sender:"assistant",timestamp:new Date,metadata:{emotion:"friendly",urgency:"normal",persona:"general",language:"de"}}]),[o,a]=l.useState(""),[d,g]=l.useState(!1),[b]=l.useState(()=>`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`),h=l.useRef(null),j=l.useRef(null),N=l.useRef(null),{isConnected:p,sendMessage:c,sendAudioMessage:m,lastMessage:f,error:u}=$e(b),{isRecording:w,startRecording:O,stopRecording:D,textToSpeech:te}=We();l.useEffect(()=>{var i;(i=h.current)==null||i.scrollIntoView({behavior:"smooth"})},[s]),l.useEffect(()=>{if(f&&f.type==="response"){const i={id:`msg_${Date.now()}`,content:f.data.response||"Antwort erhalten",sender:"assistant",timestamp:new Date,metadata:f.data.metadata};r(y=>[...y,i]),g(!1),f.data.audio&&n(i.content)}},[f,n]),l.useEffect(()=>{if(u){const i={id:`error_${Date.now()}`,content:`Entschuldigung, es ist ein Fehler aufgetreten: ${u.message}`,sender:"assistant",timestamp:new Date,metadata:{emotion:"concerned",urgency:"high",persona:"system",language:"de"}};r(y=>[...y,i]),g(!1)}},[u]);const P=async i=>{if(!i.trim()||d)return;const y={id:`msg_${Date.now()}`,content:i.trim(),sender:"user",timestamp:new Date};r(v=>[...v,y]),a(""),g(!0),c(i.trim()),t&&t(i.trim())},se=async()=>{if(w){D(),g(!0);try{const i=ee(),y=i.getRecordedAudio();if(!y)throw new Error("Kein Audio vorhanden");console.log("🎙️ Starte Audio-Chat Processing...");const v=new FormData;v.append("audio",y,"recording.webm");const C=await fetch("https://api.kaya.wattweiser.com/api/audio-chat",{method:"POST",body:v});if(!C.ok)throw new Error(`Audio-Chat Fehler: ${C.status}`);const L=await C.json();console.log("✅ Audio-Chat Response:",L);const A={id:`msg_${Date.now()}`,content:L.transcription,sender:"user",timestamp:new Date},M={id:`msg_${Date.now()+1}`,content:L.response,sender:"assistant",timestamp:new Date,metadata:{emotion:"friendly",urgency:"normal",persona:"general",language:"de"}};r(k=>[...k,A,M]),L.audioUrl&&await te(L.response),i.clearRecordedAudio(),n(L.response)}catch(i){console.error("❌ Audio-Chat fehlgeschlagen:",i);const y={id:`error_${Date.now()}`,content:`Entschuldigung, Audio-Verarbeitung fehlgeschlagen: ${i instanceof Error?i.message:"Unbekannter Fehler"}`,sender:"assistant",timestamp:new Date,metadata:{emotion:"concerned",urgency:"high",persona:"system",language:"de"}};r(v=>[...v,y])}finally{g(!1)}}else try{await O()}catch(i){console.error("❌ Audio-Aufnahme fehlgeschlagen:",i)}},ne=i=>{a(i.target.value);const y=i.target;y.style.height="auto",y.style.height=`${Math.min(y.scrollHeight,120)}px`},re=i=>{i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),P(o))},ae=i=>{var A;const y=(A=i.target.files)==null?void 0:A[0];if(!y)return;const v=5*1024*1024,E=["image/png","image/jpeg","image/jpg","application/pdf"];if(y.size>v){alert("Datei zu groß. Maximal 5MB erlaubt.");return}if(!E.includes(y.type)){alert("Dateityp nicht erlaubt. Nur PNG, JPG, PDF erlaubt.");return}const C=(y.size/1024).toFixed(2),L={id:`file_${Date.now()}`,content:`📎 ${y.name} (${C} KB)`,sender:"user",timestamp:new Date,type:"file"};r(M=>[...M,L]),N.current&&(N.current.value="")},ie=i=>{const y=/\[([^\]]+)\]\(([^)]+)\)/g,v=[];let E=0,C,L=0;const A=[];for(;(C=y.exec(i))!==null;)A.push(C);if(console.log(`🔗 ${A.length} Markdown-Links gefunden in Nachricht`),A.forEach((k,K)=>{k.index>E&&v.push(i.substring(E,k.index));const U=k[1],S=k[2];L++,console.log(`🔗 Link ${L}: "${U}" -> "${S}"`),v.push(e.jsxs("a",{href:S,target:"_blank",rel:"noopener noreferrer",className:`
            inline-flex items-center gap-1.5
            text-lc-primary-600 hover:text-lc-primary-700
            underline decoration-2 decoration-lc-primary-300
            hover:decoration-lc-primary-500
            transition-all duration-300
            font-medium
            hover:gap-2
            group
          `,onClick:T=>{console.log("🔗 Link geklickt:",S),T.stopPropagation()},children:[U,e.jsxs("svg",{className:"w-3.5 h-3.5 transition-transform duration-300 group-hover:translate-x-0.5 group-hover:-translate-y-0.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),e.jsx("polyline",{points:"15 3 21 3 21 9"}),e.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]},`link-${k.index}-${L}`)),E=k.index+k[0].length}),E<i.length&&v.push(i.substring(E)),v.length===0||A.length===0){const k=i.match(/---\n\*Quelle: (.+?) • Stand: (.+?)\*/);if(k){const[K,U,S]=k,T=i.replace(K,"").trim();return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap",children:T}),e.jsxs("div",{className:"source-footer mt-3",children:[e.jsx("strong",{children:"Quelle:"})," ",U," • ",e.jsx("strong",{children:"Stand:"})," ",S]})]})}return i}const M=i.match(/---\n\*Quelle: (.+?) • Stand: (.+?)\*/);if(M){const[k,K,U]=M,S=i.replace(k,"").trim(),T=[],ce=/\[([^\]]+)\]\(([^)]+)\)/g;let Y;for(;(Y=ce.exec(S))!==null;)T.push(Y);const z=[];let F=0;return T.forEach((R,de)=>{R.index>F&&z.push(S.substring(F,R.index));const he=R[1],H=R[2];z.push(e.jsxs("a",{href:H,target:"_blank",rel:"noopener noreferrer",className:`
              inline-flex items-center gap-1.5
              text-lc-primary-600 hover:text-lc-primary-700
              underline decoration-2 decoration-lc-primary-300
              hover:decoration-lc-primary-500
              transition-all duration-300
              font-medium
              hover:gap-2
              group
            `,onClick:ue=>{console.log("🔗 Link geklickt:",H),ue.stopPropagation()},children:[he,e.jsxs("svg",{className:"w-3.5 h-3.5 transition-transform duration-300 group-hover:translate-x-0.5 group-hover:-translate-y-0.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[e.jsx("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),e.jsx("polyline",{points:"15 3 21 3 21 9"}),e.jsx("line",{x1:"10",y1:"14",x2:"21",y2:"3"})]})]},`footer-link-${R.index}-${de}`)),F=R.index+R[0].length}),F<S.length&&z.push(S.substring(F)),e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"whitespace-pre-wrap",children:z.length>0?z:S}),e.jsxs("div",{className:"source-footer mt-3",children:[e.jsx("strong",{children:"Quelle:"})," ",K," • ",e.jsx("strong",{children:"Stand:"})," ",U]})]})}return v},oe=(()=>{var v;if(s.length<2)return[{label:"KFZ",icon:"🚗"},{label:"Bürgergeld",icon:"💰"},{label:"Kreistag",icon:"🏛️"},{label:"Termin",icon:"📅"}];switch((v=s[s.length-1].metadata)==null?void 0:v.intention){case"jobcenter":return[{label:"Antrag stellen",icon:"📄"},{label:"Termin buchen",icon:"📅"},{label:"Unterlagen?",icon:"📋"}];case"kfz_zulassung":return[{label:"Termin KFZ",icon:"🚗"},{label:"Kosten?",icon:"💰"},{label:"Unterlagen?",icon:"📄"}];case"buergerdienste":return[{label:"An-/Ummeldung",icon:"🏠"},{label:"Ausweis",icon:"🆔"},{label:"Termin",icon:"📅"}];case"politik":return[{label:"Sitzungskalender",icon:"📅"},{label:"Fraktionen",icon:"👥"},{label:"Vorlagen",icon:"📄"}];default:return[{label:"KFZ",icon:"🚗"},{label:"Bürgergeld",icon:"💰"},{label:"Kreistag",icon:"🏛️"},{label:"Termin",icon:"📅"}]}})(),le=[{id:"kfz",label:"KFZ",description:"Fahrzeug-Zulassung"},{id:"meldebescheinigung",label:"Meldebescheinigung",description:"Wohnsitz-Nachweis"},{id:"wohngeld",label:"Wohngeld",description:"Wohnkosten-Zuschuss"},{id:"termin",label:"Termin",description:"Terminvereinbarung"},{id:"stellen",label:"Stellen",description:"Job-Angebote"},{id:"kreistag",label:"Kreistag",description:"Politik & Verwaltung"}];return e.jsxs("section",{id:"chat-root","aria-label":"Chat Bereich",className:"relative bg-white md:h-[calc(100svh-4rem)] h-[80svh] md:overflow-visible overflow-hidden",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 right-0 w-[20vw] max-w-[20%] bg-gradient-to-l from-white to-transparent"}),e.jsxs("div",{className:"h-full flex flex-col pr-[5vw] md:mr-[-20vw] mr-[-20%]",children:[e.jsx("div",{className:"px-4 sm:px-6 py-3 border-b border-lc-neutral-200 bg-white/75 backdrop-blur sticky top-0 z-10",children:e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold tracking-wide text-lc-neutral-700 uppercase",children:"Chat"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${p?"bg-green-500":"bg-red-500"}`}),e.jsx("p",{className:"text-xs text-lc-neutral-500",children:p?"Verbunden":"Getrennt"})]})]})}),e.jsx("div",{className:"px-4 sm:px-6 py-3 flex flex-wrap gap-2 border-b border-lc-neutral-100 bg-white/60",children:le.map(i=>e.jsx("button",{className:"chip-link btn-interactive","aria-label":`Schnellstart ${i.label}`,onClick:()=>P(i.label),children:i.label},i.id))}),s.length>=2&&e.jsxs("div",{className:"px-4 sm:px-6 py-2 border-b border-lc-primary-100 bg-lc-primary-50/50",children:[e.jsx("p",{className:"text-xs text-lc-neutral-600 mb-2",children:"Schnell-Aktionen:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:oe.map((i,y)=>e.jsxs("button",{className:`
                    inline-flex items-center gap-1.5
                    rounded-full px-3 py-1.5
                    bg-white border-2 border-lc-primary-200
                    text-sm font-medium text-lc-primary-700
                    transition-all duration-200
                    btn-interactive quick-action
                    min-h-[48px]
                  `,"aria-label":`Schnellaktion: ${i.label}`,onClick:()=>P(i.label),children:[e.jsx("span",{children:i.icon}),i.label]},y))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 sm:px-6 py-4 space-y-4",children:[s.map(i=>e.jsx("div",{className:`flex ${i.sender==="user"?"justify-end":"justify-start"} message-animate`,children:e.jsxs("div",{className:`max-w-[70ch] md:max-w-[62ch] rounded-2xl px-5 py-4 ${i.sender==="user"?"chat-message-user":"chat-message-assistant"}`,children:[e.jsx("div",{className:"text-sm leading-relaxed",children:ie(i.content)}),i.metadata&&e.jsxs("div",{className:"mt-2 text-xs opacity-70",children:[i.metadata.emotion&&e.jsxs("span",{className:"mr-2",children:["Emotion: ",i.metadata.emotion]}),i.metadata.urgency&&e.jsxs("span",{children:["Dringlichkeit: ",i.metadata.urgency]})]})]})},i.id)),d&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"max-w-[70ch] md:max-w-[62ch] rounded-2xl px-4 py-3 bg-lc-primary-50 border border-lc-primary-200 message-animate",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-lc-primary-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("span",{className:"w-2 h-2 bg-lc-primary-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("span",{className:"w-2 h-2 bg-lc-primary-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("p",{className:"text-sm text-lc-neutral-600",children:"KAYA antwortet..."})]})})}),e.jsx("div",{ref:h})]}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 border-t border-lc-neutral-200 bg-white/90 backdrop-blur sticky bottom-0",children:[e.jsxs("form",{onSubmit:i=>{i.preventDefault(),P(o)},className:"flex items-end gap-2","aria-label":"Nachricht verfassen",children:[e.jsx("button",{type:"button",className:`
                w-14 h-14 rounded-full
                flex items-center justify-center
                text-white
                bg-gradient-to-br from-lc-primary-500 to-lc-accent-500
                ${w?"mic-button recording":"mic-button"}
                ${d?"opacity-50 cursor-not-allowed":"btn-interactive"}
              `,"aria-label":w?"Aufnahme stoppen":"Diktieren starten",onClick:se,disabled:d,title:w?"Aufnahme läuft... (Klicken zum Stoppen)":"Mikrofon aktivieren (56x56px)",children:w?e.jsx(Z,{className:"size-7 text-white"}):e.jsx(Z,{className:"size-7 text-white"})}),e.jsx("label",{className:"sr-only",htmlFor:"message",children:"Nachricht"}),e.jsx("textarea",{id:"message",ref:j,value:o,onChange:ne,onKeyPress:re,rows:1,placeholder:"Fragen Sie z. B.: 'KFZ ummelden – welche Unterlagen?'",className:"flex-1 resize-none rounded-2xl px-4 py-2 message-input",disabled:d}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:N,type:"file",className:"hidden",accept:"image/png,image/jpeg,image/jpg,application/pdf",onChange:ae}),e.jsx("button",{type:"button",className:"btn-ghost","aria-label":"Datei anhängen",onClick:()=>{var i;return(i=N.current)==null?void 0:i.click()},children:e.jsx(je,{className:"size-5"})}),e.jsx("button",{type:"submit",className:"btn-solid","aria-label":"Senden",disabled:!o.trim()||d,children:e.jsx(Ne,{className:"size-5"})})]})]}),e.jsx("p",{className:"mt-2 text-[11px] text-lc-neutral-600",children:"Hinweis: KAYA nutzt öffentliche Informationen des Landkreises Oldenburg. Keine Rechtsberatung – Notfälle: 112 / 110."})]})]})]})},Ye=()=>{const[n,t]=l.useState(()=>{const h=localStorage.getItem("kaya_accessibility");if(h)try{return JSON.parse(h)}catch{return W()}return W()}),[s,r]=l.useState(!1);l.useEffect(()=>{localStorage.setItem("kaya_accessibility",JSON.stringify(n)),He(n)},[n]);const o=()=>{t(h=>({...h,simpleLanguage:!h.simpleLanguage}))},a=()=>{t(h=>{const j=h.fontSize===100?115:h.fontSize===115?130:100;return{...h,fontSize:j}})},d=()=>{t(h=>({...h,highContrast:!h.highContrast}))},g=()=>{t(h=>({...h,reducedMotion:!h.reducedMotion}))},b=()=>{const h=W();t(h)};return e.jsxs("div",{className:"fixed top-4 right-4 z-50",children:[e.jsx("button",{onClick:()=>r(!s),className:`\r
          w-12 h-12 rounded-full glass shadow-lg\r
          flex items-center justify-center\r
          hover:scale-110 active:scale-95\r
          transition-transform duration-200\r
          btn-interactive\r
        `,"aria-label":"Barrierefreiheit einstellen","aria-expanded":s,children:e.jsx(G,{className:"w-6 h-6 text-lc-primary-600"})}),s&&e.jsxs("div",{className:"glass rounded-2xl shadow-2xl mt-4 p-4 min-w-[280px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-lc-neutral-700 uppercase tracking-wide",children:"Barrierefreiheit"}),e.jsx("button",{onClick:b,className:`\r
                p-1.5 rounded-lg\r
                hover:bg-lc-neutral-100\r
                transition-colors\r
              `,"aria-label":"Zurücksetzen",title:"Einstellungen zurücksetzen",children:e.jsx(ke,{className:"w-4 h-4 text-lc-neutral-600"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:o,className:`
                w-full flex items-center justify-between px-4 py-3 rounded-xl
                transition-all duration-200
                ${n.simpleLanguage?"bg-lc-primary-100 border-2 border-lc-primary-300":"bg-lc-neutral-50 border-2 border-transparent hover:border-lc-primary-200"}
                btn-interactive
              `,"aria-label":`Einfache Sprache ${n.simpleLanguage?"aktiviert":"deaktiviert"}`,"aria-pressed":n.simpleLanguage,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Le,{className:"w-5 h-5 text-lc-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-lc-neutral-800",children:"Einfache Sprache"})]}),n.simpleLanguage&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-lc-primary-500 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white",children:"✓"})})]}),e.jsxs("button",{onClick:a,className:`\r
                w-full flex items-center justify-between px-4 py-3 rounded-xl\r
                bg-lc-neutral-50 hover:bg-lc-primary-50\r
                border-2 border-transparent hover:border-lc-primary-200\r
                transition-all duration-200\r
                btn-interactive\r
              `,"aria-label":`Schriftgröße: ${n.fontSize}%`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Se,{className:"w-5 h-5 text-lc-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-lc-neutral-800",children:"Schriftgröße"})]}),e.jsxs("span",{className:"text-sm font-semibold text-lc-primary-600",children:[n.fontSize,"%"]})]}),e.jsxs("button",{onClick:d,className:`
                w-full flex items-center justify-between px-4 py-3 rounded-xl
                transition-all duration-200
                ${n.highContrast?"bg-lc-primary-100 border-2 border-lc-primary-300":"bg-lc-neutral-50 border-2 border-transparent hover:border-lc-primary-200"}
                btn-interactive
              `,"aria-label":`Hoher Kontrast ${n.highContrast?"aktiviert":"deaktiviert"}`,"aria-pressed":n.highContrast,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-5 h-5 text-lc-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-lc-neutral-800",children:"Hoher Kontrast"})]}),n.highContrast&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-lc-primary-500 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white",children:"✓"})})]}),e.jsxs("button",{onClick:g,className:`
                w-full flex items-center justify-between px-4 py-3 rounded-xl
                transition-all duration-200
                ${n.reducedMotion?"bg-lc-primary-100 border-2 border-lc-primary-300":"bg-lc-neutral-50 border-2 border-transparent hover:border-lc-primary-200"}
                btn-interactive
              `,"aria-label":`Weniger Animationen ${n.reducedMotion?"aktiviert":"deaktiviert"}`,"aria-pressed":n.reducedMotion,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(G,{className:"w-5 h-5 text-lc-primary-600"}),e.jsx("span",{className:"text-sm font-medium text-lc-neutral-800",children:"Weniger Animationen"})]}),n.reducedMotion&&e.jsx("div",{className:"w-5 h-5 rounded-full bg-lc-primary-500 flex items-center justify-center",children:e.jsx("span",{className:"text-xs text-white",children:"✓"})})]})]})]})]})};function W(){return{simpleLanguage:!1,fontSize:100,highContrast:!1,reducedMotion:!1,language:"de"}}function He(n){const t=document.documentElement;t.style.fontSize=`${n.fontSize}%`,n.highContrast?t.classList.add("high-contrast"):t.classList.remove("high-contrast"),n.reducedMotion?t.classList.add("reduce-motion"):t.classList.remove("reduce-motion"),n.simpleLanguage?t.setAttribute("data-simple-language","true"):t.removeAttribute("data-simple-language")}function Ze(){const[n,t]=l.useState({highContrast:!1,fontSize:100,simpleLanguage:!1,reducedMotion:!1,screenReader:!1}),[s,r]=l.useState({language:"de",theme:"light",notifications:!0,accessibility:n,audio:{enabled:!0,volume:1,language:"de-DE"}}),[o,a]=l.useState(!1),[d,g]=l.useState(""),b=c=>{t(c),r(m=>({...m,accessibility:c}))},h=c=>{r(m=>({...m,language:c,audio:{...m.audio,language:c==="de"?"de-DE":"en-US"}}))},j=(c,m)=>{console.log("🎭 Avatar-Emotion geändert:",c,m)},N=c=>{console.log("📤 Nachricht gesendet:",c)},p=()=>{const c=["min-h-[100svh] bg-lc-neutral-50 text-lc-neutral-800"];return n.highContrast&&c.push("contrast-125"),n.fontSize===115?c.push("text-[1.03rem]"):n.fontSize===130&&c.push("text-[1.1rem]"),n.simpleLanguage&&c.push("simple-language"),n.reducedMotion&&c.push("reduce-motion"),c.join(" ")};return l.useEffect(()=>{const c=document.documentElement;s.theme==="dark"?c.classList.add("dark"):c.classList.remove("dark"),n.reducedMotion?(c.style.setProperty("--animation-duration","0.01ms"),c.style.setProperty("--animation-iteration-count","1")):(c.style.removeProperty("--animation-duration"),c.style.removeProperty("--animation-iteration-count"))},[s.theme,n.reducedMotion]),l.useEffect(()=>{const c=m=>{if(m.key==="Escape"&&o&&a(!1),m.altKey&&m.key==="s"){m.preventDefault();const f=document.getElementById("chat-root");f&&(f.focus(),f.scrollIntoView({behavior:"smooth"}))}if(m.altKey&&m.key==="a"){m.preventDefault();const f=document.getElementById("unity-canvas");f&&f.focus()}};return document.addEventListener("keydown",c),()=>document.removeEventListener("keydown",c)},[o]),e.jsxs("div",{className:p(),children:[e.jsx("div",{className:"animated-background","aria-hidden":"true",children:e.jsx("div",{className:"blob-3"})}),e.jsx("a",{href:"#chat-root",className:"skiplink","aria-label":"Zum Chat-Bereich springen",children:"Zum Chat springen"}),e.jsx(Ye,{}),e.jsx(Te,{accessibility:n,onAccessibilityChange:b,onLanguageChange:h}),e.jsxs("main",{className:"grid md:grid-cols-2 grid-cols-1 min-h-[calc(100svh-4rem)]",role:"main","aria-label":"KAYA Chat-Interface",children:[e.jsx(Oe,{isSpeaking:o,captionText:d,setIsSpeaking:a,onEmotionChange:j}),e.jsx(Ve,{setCaptionText:g,onMessageSend:N})]}),n.screenReader&&e.jsx("div",{className:"sr-only","aria-live":"polite","aria-atomic":"true",children:e.jsxs("p",{children:["KAYA Chat-Interface geladen.",o?"KAYA spricht gerade.":"KAYA ist bereit für Ihre Fragen.",n.highContrast?" Hoher Kontrast aktiviert.":"",n.simpleLanguage?" Einfache Sprache aktiviert.":"","Schriftgröße: ",n.fontSize,"%."]})}),!1]})}function Ge(){return e.jsx("div",{className:"App",children:e.jsx(Ze,{})})}V.createRoot(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(Ge,{})}));
